<div class="min-h-screen bg-gray-100">
    <div class="flex justify-end text-xl mr-4 pt-2">
        <% if user_signed_in? %>
            <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :get } %>
        <% end %>
    </div>
    <div class="flex flex-col items-center justify-center">
        <div class="mb-4 flex items-center justify-center space-x-4 mb-10">
            <h1  class="text-4xl font-extrabold text-gray-900 ">打刻システム</h1>
        </div>
        <div>
            <% if user_signed_in? %>
                <p class="text-2xl text-center font-extrabold text-gray-900">ログイン中：<%= current_user.username %> さん</p>
            <% end %>
        </div>
        <div class="flex items-center justify-center space-x-4 mt-20">
            <div class="text-2xl font-extrabold text-gray-900" id="date-display"></div>
            <div class="text-2xl font-extrabold text-gray-900" id="day-of-week-display"></div>
        </div>
        <div class="mb-4 flex items-center justify-center space-x-4 mt-2 mb-10">
            <div class="text-8xl font-extrabold text-gray-900" id="time-display"></div>
        </div>
        <%= turbo_frame_tag "attendance_button" do %>
            <div class="mb-4 flex items-center justify-center space-x-4 mt-12 mb-20">
                <% today_records = @time_records.where("check_in >= ?",Time.zone.today.beginning_of_day).order(check_in: :desc) %>
                <% if today_records.any? && today_records.first.check_out.nil? %>
                    <%= button_to '退勤',  check_out_users_time_records_path, method: :post, data: { turbo_frame: 'attendance_button' }, class: "text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-4xl px-20 py-5 transition duration-300 ease-in-out transform hover:scale-105" %>
                <% else %>
                    <%= button_to '出勤', check_in_users_time_records_path, method: :post, data: { turbo_frame: 'attendance_button' }, class: "text-white bg-green-600 hover:bg-green-700 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-4xl px-20 py-5 transition duration-300 ease-in-out transform hover:scale-105" %>               
                <% end %>
            </div>
            
            <!--
            <button type="button" class="text-white bg-blue-400 dark:bg-blue-500 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center" disabled>休憩開始</button>    
            -->

            <div class="w-full max-w-2xl px-4">
                <table class="w-full mx-auto text-sm text-left text-gray-500 dark:text-gray-400">
                    <thead>
                        <tr class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                            <th scope="col" class="px-6 py-3 text-center text-xl">出勤時刻</th>
                            <th scope="col" class="px-6 py-3 text-center text-xl">退勤時刻</th>
                            <th scope="col" class="px-6 py-3 text-center text-xl">勤務時間</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                            <% @time_records.each do |record| %>
                                <td class="px-6 py-4 text-center text-xl">
                                    <%= record.check_in.strftime("%H:%M") if record.check_in %>
                                </td>
                                <td class="px-6 py-4 text-center text-xl">
                                    <% if record.check_out %>
                                        <% if record.check_out.day > record.check_in.day %>
                                        <!-- 日付を超えた場合 -->
                                            <%= (record.check_out.hour + (record.check_out.day - record.check_in.day).hour).to_s + record.check_out.strftime(":%M") %>
                                        <% else %>
                                            <%= record.check_out.strftime("%H:%M") %>
                                        <% end %>
                                    <% end %>
                                </td>
                                <td class="px-6 py-4 text-center text-xl">
                                    <% total_seconds = @user_work_times[record.user_id] || 0 %>
                                    <% hours = total_seconds / 1.hour %>
                                    <% minutes = (total_seconds % 1.hour) / 1.minute %>
                                    <%= format("%02d:%02d", hours, minutes) %>
                                </td>
                            <% end %>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="fixed bottom-0 left-0 z-50 w-full h-16 bg-white border-t border-gray-200 dark:bg-gray-700 dark:border-gray-600">
                <div class="grid h-full max-w-lg grid-cols-4 mx-auto font-medium">
                    <button type="button" class="inline-flex flex-col items-center justify-center px-5 hover:bg-gray-50 dark:hover:bg-gray-800 group">
                        <svg class="w-5 h-5 mb-2 text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="m19.707 9.293-2-2-7-7a1 1 0 0 0-1.414 0l-7 7-2 2a1 1 0 0 0 1.414 1.414L2 10.414V18a2 2 0 0 0 2 2h3a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1h3a2 2 0 0 0 2-2v-7.586l.293.293a1 1 0 0 0 1.414-1.414Z"/>
                        </svg>
                        <span class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500">打刻システム</span>
                    </button>
                    <button type="button" class="inline-flex flex-col items-center justify-center px-5 hover:bg-gray-50 dark:hover:bg-gray-800 group">
                        <svg class="w-5 h-5 mb-2 text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm3.982 13.982a1 1 0 0 1-1.414 0l-3.274-3.274A1.012 1.012 0 0 1 9 10V6a1 1 0 0 1 2 0v3.586l2.982 2.982a1 1 0 0 1 0 1.414Z"/>
                        </svg>
                        <span class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500">出勤履歴</span>
                    </button>
                    <button type="button" class="inline-flex flex-col items-center justify-center px-5 hover:bg-gray-50 dark:hover:bg-gray-800 group">
                        <svg class="w-5 h-5 mb-2 text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12.25V1m0 11.25a2.25 2.25 0 0 0 0 4.5m0-4.5a2.25 2.25 0 0 1 0 4.5M4 19v-2.25m6-13.5V1m0 2.25a2.25 2.25 0 0 0 0 4.5m0-4.5a2.25 2.25 0 0 1 0 4.5M10 19V7.75m6 4.5V1m0 11.25a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5ZM16 19v-2"/>
                        </svg>
                        <span class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500">申請</span>
                    </button>
                    <button type="button" class="inline-flex flex-col items-center justify-center px-5 hover:bg-gray-50 dark:hover:bg-gray-800 group">
                        <svg class="w-5 h-5 mb-2 text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M10 0a10 10 0 1 0 10 10A10.011 10.011 0 0 0 10 0Zm0 5a3 3 0 1 1 0 6 3 3 0 0 1 0-6Zm0 13a8.949 8.949 0 0 1-4.951-1.488A3.987 3.987 0 0 1 9 13h2a3.987 3.987 0 0 1 3.951 3.512A8.949 8.949 0 0 1 10 18Z"/>
                        </svg>
                        <span class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-blue-600 dark:group-hover:text-blue-500">プロフィール</span>
                    </button>
                </div>
            </div>
        <% end %>
    </div>
</div>

<script type="module">
        import { startClock } from "clock";
        startClock();
</script>