<!DOCTYPE html>
<html>
<head>
    <%= tag.div id: "clock" %>
    <script type="module">
        import { startClock } from "clock";
        startClock();
    </script>
</head>

<body>
    <h1>打刻システム</h1>
    <div id="date-display"></div>
    <div id="day-of-week-display"></div>
    <div id="time-display"></div>

    <% today_records = @time_records.where("check_in >= ?",Time.zone.today.beginning_of_day).order(check_in: :desc) %>
    <% if today_records.any? && today_records.first.check_out.nil? %>
        <%= button_to '退勤', check_out_time_records_path, method: :post, class: "btn btn-primary" %>
    <% else %>
        <%= button_to '出勤', check_in_time_records_path, method: :post, class: "btn btn-secondary" %>
    <% end %>

    <table>
        <thead>
            <tr>
                <th>出勤日</th>
                <th>出勤時刻</th>
                <th>退勤時刻</th>
            </tr>
        </thead>
        <tbody>
            <% @time_records.each do |record| %>
                <tr>
                    <td><%= record.check_in.strftime("%Y-%m-%d") if record.check_in %></td>
                    <td><%= record.check_in.strftime("%H:%M") if record.check_in %></td>
                    <td>
                        <% if record.check_out %>
                            <% if record.check_out.day > record.check_in.day %>
                            <!-- 日付を超えた場合 -->
                            <%= (record.check_out.hour + (record.check_out.day - record.check_in.day).hour).to_s + record.check_out.strftime(":%M") %>
                            <% else %>
                            <%= record.check_out.strftime("%H:%M") %>
                            <% end %>
                        <% end %>
                    </td>
                </tr>
            <% end %>
        </tbody>
    </table>

</body>
<footer>
    <% if user_signed_in? %>
        <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete } %>
    <% end %>
</footer>
</html>